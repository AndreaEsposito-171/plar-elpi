%%% ===========================================================================
%%% Simple test for FOL.
%%% ===========================================================================

accumulate "fol".

%%% ---------------------------------------------------------------------------
%%% Model.
%%% ---------------------------------------------------------------------------

kind dom type.
type a, b dom.

pred domain o:list dom.
domain [a, b].

pred eval_f i:dom, o:dom.
eval_f a b.
eval_f b a.

pred eval_r i:dom, o:bool.
eval_r a tt.
eval_r b ff.

pred eval_t i:dom, o:bool.
eval_t _X ff.

type x, y term.
type f term -> term.
type r, t term -> formula.

%%% ---------------------------------------------------------------------------
%%% Interpretation.
%%% ---------------------------------------------------------------------------

% Iteration.
copy/tm x x.
copy/tm y y.
copy/tm (f X) (f X1) :- copy/tm X X1.

copy/fm (r X) (r X1) :- !, copy/tm X X1.
copy/fm (t X) (t X1) :- !, copy/tm X X1.

dcopy/fm (r X) P1 :- copy/tm X Y, copy1/fm (r Y) P1.
dcopy/fm (t X) P1 :- copy/tm X Y, copy1/fm (t Y) P1.

% Terms.
termval x a.
termval y b.
termval (f X) A :- eval_f {termval X} A.

% Atomic formulas.
eval (r X) B :- eval_r {termval X} B.
eval (t X) B :- eval_t {termval X} B.

%%% ---------------------------------------------------------------------------
%%% Tests.
%%% ---------------------------------------------------------------------------

main :-
    run_tests
    [ report "holds"
    , okb (holds (r x))
    , kob (holds (r y))
    , kob (holds (t x))
    , okb (holds (t x !! r x))
    , kob (holds (t x && r x))
    , okb (holds (r y !! r x))
    , kob (holds (r y && r x))
    , kob (holds (all a\ r (f a)))
    , okb (holds (ex  a\ r (f a)))
    , okb (holds/c (ctx a\ formula/c (r a !! r x)))
    , kob (holds/c (ctx a\ formula/c (r a && r x)))
    , report "simplify"
    , ok_eq (all X \ r X) (simplify (all X \ ex U \ r X))
    , ok_eq (all X \ r X && t y) (simplify (all X \ ex U \ r X && ex Y \ t y))
    , ok_eq (neg (r x) !! neg (r y)) (nnf (neg (r x && r y)))
    , ok_eq ((ex X \ neg (r X)) !! r y)
            (nnf (neg ((all X \ r X) && ex X \ neg (r y))))
    , report "pnf"
    , ok_eq (neg (all X \ r X) !! r x && r x)
            (simplify (ex A \ neg (all X \ r X) !! r x && (ex Y \ r x)))
    , ok_eq (ex X \ neg (r X) !! r x && t x)
            (pnf (ex A \ neg (all X \ r X) !! r x && (ex Y \ t x)))
    , ok_eq (ex X \ neg (r X) !! r x) (pnf (neg (all X \ r X) !! r x))
    , ok_eq (ex X \ neg (r X)) (nnf (neg (all X \ r X)))
    , ok_eq (ex X \ neg (r X)) (prenex (ex X \ neg (r X)))
    ].
